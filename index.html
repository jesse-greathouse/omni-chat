<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; media-src 'self' data:">
    <title>Omni Chat</title>
    <style>
      :root {
        --bg: #0f1115;
        --fg: #e6e6e6;
        --muted: #9aa0a6;
        --accent: #4c8bf5;
        --accent-2: #2f6feb;
        --error: #ffdddd;
        --error-bg: #2a0000;
        --panel: #141821;
        --panel-2: #181c26;
        --border: #2a2f3a;
        --tab-bg: #1b2130;
        --tab-active: #22293b;
        --footer-h: 46px;
        --footer-gap: 6px;
      }
      * { box-sizing: border-box; }
      html { overscroll-behavior: none; }
      html, body { height: 100%; margin: 0; background: var(--bg); color: var(--fg);
        font: 13px/1.4 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
      button, input, select { font: inherit; }

      /* Layout */
      #app {
        display: grid;
        grid-template-rows: 44px 1fr auto; /* topbar, content stack, error dock */
        height: 100%;
      }
      #topbar {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 6px 10px;
        border-bottom: 1px solid var(--border);
        background: var(--panel);
        min-height: 44px;
      }
      #brand { font-weight: 600; letter-spacing: .2px; margin-right: 6px; }
      .spacer { flex: 1; }
      .pill { padding: 6px 10px; border: 1px solid var(--border); background: var(--tab-bg); color: var(--fg); border-radius: 6px; cursor: pointer; }
      .pill:hover { border-color: var(--accent); }

      /* Tabs (in topbar, Chrome-style) */
      #tabbar{
        display:flex; align-items:center; gap:6px;
        overflow:auto; /* let tabs scroll horizontally if many */
        -webkit-overflow-scrolling: touch;
        flex: 1; /* take the middle space */
        padding: 0 6px;
      }
      .tab{
        display:flex; align-items:center; gap:8px;
        padding:4px 10px; height: 30px;
        border:1px solid var(--border); background: var(--tab-bg);
        border-radius:8px; cursor:pointer; user-select:none; max-width: 240px;
      }
      .tab.active{ background: var(--tab-active); border-color: var(--accent-2); }
      .tab .title{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
      .tab .close{ opacity:.8; }
      #newTabBtn{
        padding:4px 10px; height:30px;
        border:1px dashed var(--border); background: transparent; color: var(--fg);
        border-radius:8px; cursor:pointer; white-space:nowrap;
      }
      #newTabBtn:hover{ border-color: var(--accent); }

      /* Main stack of layers */
      #views {
        position: relative; /* parent for absolute layers */
        min-height: 0;
        background: var(--panel-2);
      }
      .view-layer {
        position: absolute; inset: 0;
        display: block;
        min-height: 0;
      }
      .view-layer.hidden { display: none; }

      /* Network view inside a layer */
      .net-view {
        position: absolute; inset: 0;
        min-height: 0;
        display: grid;
        grid-template-columns: 220px 1fr; /* left sidebar for channels */
        background: var(--panel-2);
        border-top: 1px solid var(--border);
      }
      .net-view.hidden { display: none; }

      .console-pane {
        position: relative;
        height: 100%;
        min-height: 0;
        display: grid;
        grid-template-rows: 1fr;
        overflow: hidden;
      }
      .console-pane.hidden { display: none; }

      /* Channel sidebar (vertical) */
      .chan-list {
        grid-column: 1;
        display: flex;
        flex-direction: column;
        gap: 6px;
        padding: 8px;
        border-right: 1px solid var(--border);
        background: var(--panel);
        overflow: auto;
        min-width: 0;
      }
      .chan-item {
        padding: 6px 10px;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--tab-bg);
        cursor: pointer;
        user-select: none;
        white-space: nowrap;
      }
      .chan-item.active { background: var(--tab-active); border-color: var(--accent-2); }

      /* Channel pane */
      .chan-pane {
        position: relative;
        height: 100%;
        min-height: 0;
        display: grid;
        grid-template-columns: 1fr 400px;
        grid-template-rows: 1fr;
        overflow: hidden;
      }
      .chan-pane.hidden { display: none; }

      .transcript {
        grid-column: 1; grid-row: 1;
        padding: 10px 12px;
        overflow: auto;
        padding-bottom: calc(var(--footer-h) + var(--footer-gap));
        white-space: pre-wrap;
        word-break: break-word;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        background: #0f121a;
        border-right: 1px solid var(--border);
      }
      .users {
        grid-column: 2; grid-row: 1;
        padding: 8px;
        border-left: 1px solid var(--border);
        background: #101521;
        overflow: auto;
        padding-bottom: calc(var(--footer-h) + var(--footer-gap));
      }
      .users h4 { margin: 0 0 6px 0; font-size: 12px; color: var(--muted); }
      .user { display: inline-block; margin: 4px; padding: 4px 8px; border: 1px solid var(--border); border-radius: 12px; background: #121828; cursor: pointer; }
      .user:hover { border-color: var(--accent-2); }

      .input-row {
        grid-column: 1 / -1;
        position: sticky;
        bottom: var(--footer-gap);
        z-index: 2;
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 8px;
        padding: 8px;
        height: var(--footer-h);
        border-top: 1px solid var(--border);
        background: var(--panel);
      }
      .send-btn {
        padding: 8px 12px;
        border: 1px solid var(--border);
        background: #141b2b;
        color: var(--fg);
        border-radius: 6px;
        cursor: pointer;
      }
      .send-btn:hover { border-color: var(--accent-2); }
      .msg-input {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid var(--border);
        background: #0e1320;
        color: var(--fg);
        border-radius: 6px;
        outline: none;
      }
      .topic { margin: 0 0 8px 0; font-size: 12px; color: var(--muted); }

      /* Profiles / connection panel */
      .conn-wrap {
        height: 100%;
        display: grid;
        place-items: center;
        padding: 16px;
      }
      .conn-card {
        width: min(1000px, 92vw);
        max-height: 92vh;         /* scale with viewport height */
        border: 1px solid var(--border);
        background: var(--panel);
        border-radius: 10px;
        padding: 16px;
        display: grid;            /* allow inner grid to claim remaining height */
        grid-template-rows: auto 1fr;
      }
      .conn-card h3 { margin: 0 0 10px 0; }
      /* two-column layout that stretches; collapses to one column when narrow */
      .conn-grid {
        display: grid;
        grid-template-columns: minmax(260px, 1fr) minmax(420px, 1.5fr);
        gap: 16px;
        height: 100%;
      }
      @media (max-width: 880px) {
        .conn-grid { grid-template-columns: 1fr; }
      }

      /* make the server profiles section vertically flexible */
      .server-profiles { display: flex; flex-direction: column; }
      .server-profiles .profiles-list {
        flex: 1 1 auto;
        min-height: 220px;        /* has some body even on small windows */
        overflow: auto;           /* scroll only when it actually needs to */
      }
      .form-row select {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--tab-bg);
        color: var(--fg);
        outline: none;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
      }
      .form-row select:focus { border-color: var(--accent-2); }
      .form-row select option {
        background: var(--panel);
        color: var(--fg);
      }
      .form-row { display: grid; grid-template-columns: 120px 1fr; gap: 8px; align-items: center; margin: 8px 0; }
      .form-row input[type="text"], .form-row input[type="number"], .form-row input[type="password"] {
        width: 100%; padding: 8px 10px; border: 1px solid var(--border); border-radius: 6px; background: #0e1320; color: var(--fg);
      }
      .form-row input[type="checkbox"] { transform: translateY(1px); }
      .row-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 12px; }
      .btn { padding: 8px 12px; border: 1px solid var(--border); background: #141b2b; color: var(--fg); border-radius: 6px; cursor: pointer; }
      .btn:hover { border-color: var(--accent-2); }

      /* Error console */
      #errorDock {
        border-top: 1px solid var(--border);
        background: var(--error-bg);
        color: var(--error);
        max-height: 220px;
        overflow: auto;
        padding: 8px;
      }
      #errorDock.hidden { display: none; }

      /* Channel List pane (embedded) */
      .chanlist-pane { display: grid; grid-template-rows: auto 1fr; height: 100%; }
      .chanlist-pane.hidden { display: none; }
      .chanlist-top {
        padding: 8px 12px; border-bottom: 1px solid var(--border); background: var(--panel);
        display: flex; gap: 8px; align-items: center;
      }
      .chanlist-info { color: var(--muted); }
      .chanlist-btn {
        padding: 6px 10px; border: 1px solid var(--border); background: var(--tab-bg);
        color: var(--fg); border-radius: 6px; cursor: pointer;
      }
      .chanlist-btn:disabled { opacity: .6; cursor: not-allowed; }
      .chanlist-tableWrap { position: relative; overflow: auto; }
      .chanlist-loading {
        position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
        pointer-events: none;
      }
      .chanlist-loading[hidden] { display: none; }
      .spinner {
        width: 28px; height: 28px; border-radius: 50%;
        border: 3px solid var(--border);
        border-top-color: #9aa0a6;
        animation: spin .8s linear infinite;
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      .chanlist-pane table { width: 100%; border-collapse: collapse; }
      .chanlist-pane th, .chanlist-pane td { padding: 8px 10px; border-bottom: 1px solid var(--border); vertical-align: top; }
      .chanlist-pane th { text-align: left; color: var(--muted); position: sticky; top: 0; background: var(--panel); }
      .chanlist-pane .chan-btn {
        border: 1px solid var(--border); background: #0e1320; color: var(--fg);
        border-radius: 6px; padding: 6px 10px; cursor: pointer; text-align: left; width: 100%;
      }
      .chanlist-pane .chan-btn:hover { border-color: var(--accent-2); }
      .chanlist-pane td.num, .chanlist-pane th.num { text-align: right; }
      .chanlist-empty { color: var(--muted); padding: 12px; }
    </style>
  </head>
  <body>
    <div id="app">
      <div id="topbar">
        <div id="brand">Omni Chat</div>
        <div id="tabbar" aria-label="Connections"></div>
        <div class="spacer"></div>
        <button id="toggleErrors" class="pill">Errors</button>
      </div>

      <div id="views"></div>

      <div id="errorDock" class="hidden"></div>
    </div>

    <script type="module" src="renderer/main.js"></script>
  </body>
</html>
